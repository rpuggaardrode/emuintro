<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>An introduction to emuR - 6&nbsp; Configuring emuR for ToBI annotations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./query.html" rel="next">
<link href="./forced_alignment.html" rel="prev">
<link href="./cover.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./tobi2emu.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Configuring `emuR` for ToBI annotations</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">An introduction to <code>emuR</code></a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Initial setup</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">A schematic overview of the Emu Speech Database Management System</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./first_steps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">First steps in using the Emu Speech Database Management System</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wav2emu.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Creating an Emu database from .wav files</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./praat2emu.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Converting a Praat TextGrid collection and tracking pitch</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./forced_alignment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Forced alignment in <code>emuR</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tobi2emu.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Configuring <code>emuR</code> for ToBI annotations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./query.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">The Emu query language</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#objective-and-preliminaries" id="toc-objective-and-preliminaries" class="nav-link active" data-scroll-target="#objective-and-preliminaries"><span class="header-section-number">6.1</span> Objective and preliminaries</a></li>
  <li><a href="#forced-alignment" id="toc-forced-alignment" class="nav-link" data-scroll-target="#forced-alignment"><span class="header-section-number">6.2</span> Forced alignment</a></li>
  <li><a href="#configuring-a-database-for-tobi-annotations" id="toc-configuring-a-database-for-tobi-annotations" class="nav-link" data-scroll-target="#configuring-a-database-for-tobi-annotations"><span class="header-section-number">6.3</span> Configuring a database for ToBI annotations</a>
  <ul class="collapse">
  <li><a href="#create-and-display-word-level-annotations" id="toc-create-and-display-word-level-annotations" class="nav-link" data-scroll-target="#create-and-display-word-level-annotations"><span class="header-section-number">6.3.1</span> Create and display word level annotations</a></li>
  <li><a href="#create-a-tone-level-and-link-it-to-ort2" id="toc-create-a-tone-level-and-link-it-to-ort2" class="nav-link" data-scroll-target="#create-a-tone-level-and-link-it-to-ort2"><span class="header-section-number">6.3.2</span> Create a <code>Tone</code> level and link it to <code>ORT2</code></a></li>
  <li><a href="#calculating-and-displaying-f0" id="toc-calculating-and-displaying-f0" class="nav-link" data-scroll-target="#calculating-and-displaying-f0"><span class="header-section-number">6.3.3</span> Calculating and displaying <em>F</em><sub>0</sub></a></li>
  <li><a href="#automatically-linking-annotations-at-the-tone-level" id="toc-automatically-linking-annotations-at-the-tone-level" class="nav-link" data-scroll-target="#automatically-linking-annotations-at-the-tone-level"><span class="header-section-number">6.3.4</span> Automatically linking annotations at the <code>Tone</code> level</a></li>
  </ul></li>
  <li><a href="#adding-a-cv-level" id="toc-adding-a-cv-level" class="nav-link" data-scroll-target="#adding-a-cv-level"><span class="header-section-number">6.4</span> Adding a CV level</a></li>
  <li><a href="#functions-introduced-in-this-chapter" id="toc-functions-introduced-in-this-chapter" class="nav-link" data-scroll-target="#functions-introduced-in-this-chapter"><span class="header-section-number">6.5</span> Functions introduced in this chapter</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-tobi2emu" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Configuring <code>emuR</code> for ToBI annotations</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="objective-and-preliminaries" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="objective-and-preliminaries"><span class="header-section-number">6.1</span> Objective and preliminaries</h2>
<p>The objective of this chapter is to show how to go from a collection of <code>.wav</code> and <code>.txt</code> files to an Emu database that is set up for <strong>to</strong>nes-and-<strong>b</strong>reak <strong>i</strong>ndices (ToBI) annotation. More specifically, the aim is to configure a database to have a configuration like that shown in <a href="#fig-tobi">Figure&nbsp;<span>6.1</span></a>.</p>
<div id="fig-tobi" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/figtobi.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;6.1: An Emu database with ToBI annotations.</figcaption>
</figure>
</div>
<p>The starting point is the text collection of Albanian data analyzed in <a href="forced_alignment.html"><span>Chapter&nbsp;5</span></a>.</p>
<p>We will also see how an annotation level with syllable structures can be ascertained from a database by creating a CV-style annotation level.</p>
<p>We assume that you already have an R project called <code>ipsR</code> and that it contains the directories <code>emu_databases</code> and <code>testsample</code>. If this is not the case, please go back and follow the preliminaries chapter. As in previous chapters, we start by loading the usual libraries and renaming the directories to <code>sourceDir</code> and <code>targetDir</code>.</p>
<!-- add final link to prelim chapter when this is done -->
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emuR)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wrassp)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>sourceDir <span class="ot">&lt;-</span> <span class="st">"./testsample"</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>targetDir <span class="ot">&lt;-</span> <span class="st">"./emu_databases"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="forced-alignment" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="forced-alignment"><span class="header-section-number">6.2</span> Forced alignment</h2>
<p>The first task is to force-align these Albanian data. The commands will be presented in this section without detailed comment since these were already discussed in <a href="forced_alignment.html"><span>Chapter&nbsp;5</span></a>. The resulting Emu database will be stored as <code>alb2_DB</code> (to distinguish it from the one created in the <a href="forced_alignment.html"><span>Chapter&nbsp;5</span></a>).</p>
<p>We first create and load the Emu database using <code>convert_txtCollection()</code> and <code>load_emuDB()</code>, and subsequently use <code>runBASwebservice_all()</code> to run the MAUS pipeline over the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>path.albanian <span class="ot">&lt;-</span> <span class="fu">file.path</span>(sourceDir, <span class="st">"albanian"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">convert_txtCollection</span>(<span class="at">dbName =</span> <span class="st">"alb2"</span>, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sourceDir =</span> path.albanian,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">targetDir =</span> targetDir,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>alb2_DB <span class="ot">&lt;-</span> <span class="fu">load_emuDB</span>(<span class="fu">file.path</span>(targetDir, <span class="st">"alb2_emuDB"</span>),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">runBASwebservice_all</span>(alb2_DB,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">transcriptionAttributeDefinitionName =</span> <span class="st">"transcription"</span>, </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">language =</span> <span class="st">"sqi-AL"</span>,  </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">runMINNI =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="configuring-a-database-for-tobi-annotations" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="configuring-a-database-for-tobi-annotations"><span class="header-section-number">6.3</span> Configuring a database for ToBI annotations</h2>
<p>The database currently has an <code>ITEM</code>-type annotation level <code>ORT</code> that dominates an <code>ITEM</code>-type level <code>MAS</code> containing syllabifications. <code>MAS</code> dominates the <code>SEGMENT</code>-type level <code>MAU</code>, which contains the phonetic segmentation. You can confirm this either by <code>serve()</code>ing the database or by calling <code>summary(alb2_DB)</code>.</p>
<p>Our next task is to add a level <code>Tone</code> for marking intonational events and to add a new <code>SEGMENT</code> level, <code>ORT2</code> which contains word-level segmentations. The tonal events of the <code>Tone</code> level and annotations of the <code>ORT2</code> level are to be linked automatically, just as in <a href="#fig-tobi">Figure&nbsp;<span>6.1</span></a>.</p>
<p>The steps required to get there are as follows:</p>
<ul>
<li>Create a <code>SEGMENT</code>-type level called <code>ORT2</code> containing word annotations linked to times.</li>
<li>Create a <code>Tone</code> level and link it to <code>ORT2</code>.</li>
<li>Calculate and display pitch tracks.</li>
<li>Annotate the <code>Tone</code> level and link the annotations automatically to the word level annotations in <code>ORT2</code>.</li>
</ul>
<section id="create-and-display-word-level-annotations" class="level3" data-number="6.3.1">
<h3 data-number="6.3.1" class="anchored" data-anchor-id="create-and-display-word-level-annotations"><span class="header-section-number">6.3.1</span> Create and display word level annotations</h3>
<p>First we create and display word level annotations. This is a four step process:</p>
<p>First, <em>create a <code>SEGMENT</code>-type annotation level called <code>ORT2</code>.</em></p>
<p>As covered in <a href="praat2emu.html"><span>Chapter&nbsp;4</span></a>, this can be done with the <code>add_levelDefinition()</code> function like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">add_levelDefinition</span>(alb2_DB, </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">"ORT2"</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">type =</span> <span class="st">"SEGMENT"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can confirm that this step was successful with the function <code>list_levelDefinitions()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list_levelDefinitions</span>(alb2_DB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["name"],"name":[1],"type":["chr"],"align":["left"]},{"label":["type"],"name":[2],"type":["chr"],"align":["left"]},{"label":["nrOfAttrDefs"],"name":[3],"type":["int"],"align":["right"]},{"label":["attrDefNames"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"bundle","2":"ITEM","3":"2","4":"bundle; transcription;"},{"1":"ORT","2":"ITEM","3":"3","4":"ORT; KAN; KAS;"},{"1":"MAU","2":"SEGMENT","3":"1","4":"MAU;"},{"1":"MAS","2":"ITEM","3":"1","4":"MAS;"},{"1":"ORT2","2":"SEGMENT","3":"1","4":"ORT2;"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Second, <em>make a list of all words in the database.</em></p>
<p>We can do this by using the <code>query()</code> function to find all annotations in the <code>ORT</code> level. We’ll remove the <code>end</code> column from the resulting object to ensure as we don’t need end times for these labels, and including it can create issues down the line. (As in previous chapters, we’ll also remove the <code>db_uuid</code> column from the printed results because the data frame is more legible this way).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>text.s <span class="ot">&lt;-</span> <span class="fu">query</span>(alb2_DB, <span class="st">"ORT =~ .*"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>end)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>text.s <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>db_uuid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["labels"],"name":[1],"type":["chr"],"align":["left"]},{"label":["start"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["session"],"name":[3],"type":["chr"],"align":["left"]},{"label":["bundle"],"name":[4],"type":["chr"],"align":["left"]},{"label":["start_item_id"],"name":[5],"type":["int"],"align":["right"]},{"label":["end_item_id"],"name":[6],"type":["int"],"align":["right"]},{"label":["level"],"name":[7],"type":["chr"],"align":["left"]},{"label":["attribute"],"name":[8],"type":["chr"],"align":["left"]},{"label":["start_item_seq_idx"],"name":[9],"type":["int"],"align":["right"]},{"label":["end_item_seq_idx"],"name":[10],"type":["int"],"align":["right"]},{"label":["type"],"name":[11],"type":["chr"],"align":["left"]},{"label":["sample_start"],"name":[12],"type":["int"],"align":["right"]},{"label":["sample_end"],"name":[13],"type":["int"],"align":["right"]},{"label":["sample_rate"],"name":[14],"type":["int"],"align":["right"]}],"data":[{"1":"lena","2":"1049.9887","3":"0000","4":"0001BF_1syll_1","5":"2","6":"2","7":"ORT","8":"ORT","9":"1","10":"1","11":"ITEM","12":"46305","13":"73646","14":"44100"},{"1":"leu","2":"1669.9887","3":"0000","4":"0001BF_1syll_1","5":"3","6":"3","7":"ORT","8":"ORT","9":"2","10":"2","11":"ITEM","12":"73647","13":"92609","14":"44100"},{"1":"nje","2":"2099.9887","3":"0000","4":"0001BF_1syll_1","5":"4","6":"4","7":"ORT","8":"ORT","9":"3","10":"3","11":"ITEM","12":"92610","13":"100988","14":"44100"},{"1":"mur","2":"2289.9887","3":"0000","4":"0001BF_1syll_1","5":"5","6":"5","7":"ORT","8":"ORT","9":"4","10":"4","11":"ITEM","12":"100989","13":"122156","14":"44100"},{"1":"malena","2":"1299.9887","3":"0000","4":"0001BF_2syll_1","5":"2","6":"2","7":"ORT","8":"ORT","9":"1","10":"1","11":"ITEM","12":"57330","13":"96578","14":"44100"},{"1":"leu","2":"2189.9887","3":"0000","4":"0001BF_2syll_1","5":"3","6":"3","7":"ORT","8":"ORT","9":"2","10":"2","11":"ITEM","12":"96579","13":"117746","14":"44100"},{"1":"murin","2":"2669.9887","3":"0000","4":"0001BF_2syll_1","5":"4","6":"4","7":"ORT","8":"ORT","9":"3","10":"3","11":"ITEM","12":"117747","13":"150821","14":"44100"},{"1":"marilena","2":"1089.9887","3":"0000","4":"0001BF_3syll_1","5":"2","6":"2","7":"ORT","8":"ORT","9":"1","10":"1","11":"ITEM","12":"48069","13":"93050","14":"44100"},{"1":"leu","2":"2109.9887","3":"0000","4":"0001BF_3syll_1","5":"3","6":"3","7":"ORT","8":"ORT","9":"2","10":"2","11":"ITEM","12":"93051","13":"110249","14":"44100"},{"1":"njomezen","2":"2499.9887","3":"0000","4":"0001BF_3syll_1","5":"4","6":"4","7":"ORT","8":"ORT","9":"3","10":"3","11":"ITEM","12":"110250","13":"150821","14":"44100"},{"1":"lena","2":"899.9887","3":"0000","4":"0001CF_ord1_4","5":"2","6":"2","7":"ORT","8":"ORT","9":"1","10":"1","11":"ITEM","12":"39690","13":"60416","14":"44100"},{"1":"leu","2":"1369.9887","3":"0000","4":"0001CF_ord1_4","5":"3","6":"3","7":"ORT","8":"ORT","9":"2","10":"2","11":"ITEM","12":"60417","13":"71441","14":"44100"},{"1":"njomezen","2":"1619.9887","3":"0000","4":"0001CF_ord1_4","5":"4","6":"4","7":"ORT","8":"ORT","9":"3","10":"3","11":"ITEM","12":"71442","13":"105839","14":"44100"},{"1":"jo","2":"2549.9887","3":"0000","4":"0001CF_ord1_4","5":"5","6":"5","7":"ORT","8":"ORT","9":"4","10":"4","11":"ITEM","12":"112455","13":"125243","14":"44100"},{"1":"lena","2":"2839.9887","3":"0000","4":"0001CF_ord1_4","5":"6","6":"6","7":"ORT","8":"ORT","9":"5","10":"5","11":"ITEM","12":"125244","13":"144647","14":"44100"},{"1":"leu","2":"3279.9887","3":"0000","4":"0001CF_ord1_4","5":"7","6":"7","7":"ORT","8":"ORT","9":"6","10":"6","11":"ITEM","12":"144648","13":"156554","14":"44100"},{"1":"murin","2":"3549.9887","3":"0000","4":"0001CF_ord1_4","5":"8","6":"8","7":"ORT","8":"ORT","9":"7","10":"7","11":"ITEM","12":"156555","13":"189188","14":"44100"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>We can use the segment list generated by the <code>query()</code> above to populate our new level <code>ORT2</code>. We simply need to change the columns <code>attribute</code> and <code>level</code> so they show the value <code>ORT2</code> instead of <code>ORT</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>text.s<span class="sc">$</span>attribute <span class="ot">&lt;-</span> <span class="st">"ORT2"</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>text.s<span class="sc">$</span>level <span class="ot">&lt;-</span> <span class="st">"ORT2"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Third, <em>add word-level annotations to <code>ORT2</code>.</em></p>
<p>We can now pass <code>text.s</code> on to the function <code>create_itemsInLevel()</code> like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">create_itemsInLevel</span>(alb2_DB, text.s,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It is now possible to <code>query()</code> the word level annotations directly from <code>ORT2</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">query</span>(alb2_DB, <span class="st">"ORT2 =~ .*"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>db_uuid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["labels"],"name":[1],"type":["chr"],"align":["left"]},{"label":["start"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["end"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["session"],"name":[4],"type":["chr"],"align":["left"]},{"label":["bundle"],"name":[5],"type":["chr"],"align":["left"]},{"label":["start_item_id"],"name":[6],"type":["int"],"align":["right"]},{"label":["end_item_id"],"name":[7],"type":["int"],"align":["right"]},{"label":["level"],"name":[8],"type":["chr"],"align":["left"]},{"label":["attribute"],"name":[9],"type":["chr"],"align":["left"]},{"label":["start_item_seq_idx"],"name":[10],"type":["int"],"align":["right"]},{"label":["end_item_seq_idx"],"name":[11],"type":["int"],"align":["right"]},{"label":["type"],"name":[12],"type":["chr"],"align":["left"]},{"label":["sample_start"],"name":[13],"type":["int"],"align":["right"]},{"label":["sample_end"],"name":[14],"type":["int"],"align":["right"]},{"label":["sample_rate"],"name":[15],"type":["int"],"align":["right"]}],"data":[{"1":"lena","2":"1049.9887","3":"1669.989","4":"0000","5":"0001BF_1syll_1","6":"26","7":"26","8":"ORT2","9":"ORT2","10":"1","11":"1","12":"SEGMENT","13":"46305","14":"73646","15":"44100"},{"1":"leu","2":"1669.9887","3":"2099.989","4":"0000","5":"0001BF_1syll_1","6":"27","7":"27","8":"ORT2","9":"ORT2","10":"2","11":"2","12":"SEGMENT","13":"73647","14":"92609","15":"44100"},{"1":"nje","2":"2099.9887","3":"2289.989","4":"0000","5":"0001BF_1syll_1","6":"28","7":"28","8":"ORT2","9":"ORT2","10":"3","11":"3","12":"SEGMENT","13":"92610","14":"100988","15":"44100"},{"1":"mur","2":"2289.9887","3":"3664.887","4":"0000","5":"0001BF_1syll_1","6":"29","7":"29","8":"ORT2","9":"ORT2","10":"4","11":"4","12":"SEGMENT","13":"100989","14":"161621","15":"44100"},{"1":"malena","2":"1299.9887","3":"2189.989","4":"0000","5":"0001BF_2syll_1","6":"28","7":"28","8":"ORT2","9":"ORT2","10":"1","11":"1","12":"SEGMENT","13":"57330","14":"96578","15":"44100"},{"1":"leu","2":"2189.9887","3":"2669.989","4":"0000","5":"0001BF_2syll_1","6":"29","7":"29","8":"ORT2","9":"ORT2","10":"2","11":"2","12":"SEGMENT","13":"96579","14":"117746","15":"44100"},{"1":"murin","2":"2669.9887","3":"3991.984","4":"0000","5":"0001BF_2syll_1","6":"30","7":"30","8":"ORT2","9":"ORT2","10":"3","11":"3","12":"SEGMENT","13":"117747","14":"176046","15":"44100"},{"1":"marilena","2":"1089.9887","3":"2109.989","4":"0000","5":"0001BF_3syll_1","6":"34","7":"34","8":"ORT2","9":"ORT2","10":"1","11":"1","12":"SEGMENT","13":"48069","14":"93050","15":"44100"},{"1":"leu","2":"2109.9887","3":"2499.989","4":"0000","5":"0001BF_3syll_1","6":"35","7":"35","8":"ORT2","9":"ORT2","10":"2","11":"2","12":"SEGMENT","13":"93051","14":"110249","15":"44100"},{"1":"njomezen","2":"2499.9887","3":"4335.703","4":"0000","5":"0001BF_3syll_1","6":"36","7":"36","8":"ORT2","9":"ORT2","10":"3","11":"3","12":"SEGMENT","13":"110250","14":"191204","15":"44100"},{"1":"lena","2":"899.9887","3":"1369.989","4":"0000","5":"0001CF_ord1_4","6":"54","7":"54","8":"ORT2","9":"ORT2","10":"1","11":"1","12":"SEGMENT","13":"39690","14":"60416","15":"44100"},{"1":"leu","2":"1369.9887","3":"1619.989","4":"0000","5":"0001CF_ord1_4","6":"55","7":"55","8":"ORT2","9":"ORT2","10":"2","11":"2","12":"SEGMENT","13":"60417","14":"71441","15":"44100"},{"1":"njomezen","2":"1619.9887","3":"2549.989","4":"0000","5":"0001CF_ord1_4","6":"56","7":"56","8":"ORT2","9":"ORT2","10":"3","11":"3","12":"SEGMENT","13":"71442","14":"112454","15":"44100"},{"1":"jo","2":"2549.9887","3":"2839.989","4":"0000","5":"0001CF_ord1_4","6":"57","7":"57","8":"ORT2","9":"ORT2","10":"4","11":"4","12":"SEGMENT","13":"112455","14":"125243","15":"44100"},{"1":"lena","2":"2839.9887","3":"3279.989","4":"0000","5":"0001CF_ord1_4","6":"58","7":"58","8":"ORT2","9":"ORT2","10":"5","11":"5","12":"SEGMENT","13":"125244","14":"144647","15":"44100"},{"1":"leu","2":"3279.9887","3":"3549.989","4":"0000","5":"0001CF_ord1_4","6":"59","7":"59","8":"ORT2","9":"ORT2","10":"6","11":"6","12":"SEGMENT","13":"144648","14":"156554","15":"44100"},{"1":"murin","2":"3549.9887","3":"4898.152","4":"0000","5":"0001CF_ord1_4","6":"60","7":"60","8":"ORT2","9":"ORT2","10":"7","11":"7","12":"SEGMENT","13":"156555","14":"216008","15":"44100"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Fourth, <em>display the annotations of <code>ORT2</code> time-aligned to the signals.</em></p>
<p>Because <code>ORT2</code> is a <code>SEGMENT</code>-type level and not an <code>ITEM</code>-type level, we can now display word-level annotations underneath the signals in the <code>EMU-webApp</code>. However, if we <code>serve()</code> the database now, only the segment-level annotations in <code>MAU</code> can be seen. As covered in <a href="praat2emu.html"><span>Chapter&nbsp;4</span></a>, this can be controlled with the <code>set_levelCanvasesOrder()</code> function like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set_levelCanvasesOrder</span>(alb2_DB,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">perspectiveName =</span> <span class="st">"default"</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">order =</span> <span class="st">"ORT2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>serve()</code>ing the database now will show only the word-level annotations in <code>ORT2</code> underneath the signals:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">serve</span>(alb2_DB, <span class="at">useViewer =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-a-tone-level-and-link-it-to-ort2" class="level3" data-number="6.3.2">
<h3 data-number="6.3.2" class="anchored" data-anchor-id="create-a-tone-level-and-link-it-to-ort2"><span class="header-section-number">6.3.2</span> Create a <code>Tone</code> level and link it to <code>ORT2</code></h3>
<p>Creating new annotation level called <code>Tone</code> and linking it to <code>ORT2</code> is a three-step process:</p>
<p>First, <em>create the new annotation level named <code>Tone</code>.</em></p>
<p>We do this with the <code>add_levelDefinition()</code> function, just as we did earlier when creating <code>ORT2</code>. <code>Tone</code> should be an <code>EVENT</code>-type level, since we want to mark intonational targets as single points in time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">add_levelDefinition</span>(alb2_DB, </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">"Tone"</span>, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">type =</span> <span class="st">"EVENT"</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Second, <em>create the link between <code>Tone</code> and <code>ORT2</code>.</em></p>
<p>The function <code>list_linkDefinitions()</code> shows that there are no currently no links between <code>Tone</code> and <code>ORT2</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list_linkDefinitions</span>(alb2_DB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["type"],"name":[1],"type":["chr"],"align":["left"]},{"label":["superlevelName"],"name":[2],"type":["chr"],"align":["left"]},{"label":["sublevelName"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"ONE_TO_MANY","2":"bundle","3":"ORT"},{"1":"ONE_TO_MANY","2":"ORT","3":"MAS"},{"1":"ONE_TO_MANY","2":"MAS","3":"MAU"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>In order to allow for annotations in the two levels to be queried relative to each other, they need to be linked. On the assumption that a word can be associated with one or more tones, but that a given tone can only be associated with one word, the association between the two levels should be <code>ONE_TO_MANY</code>. The levels should therefore be linked in the following way with the <code>add_linkDefinitions()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">add_linkDefinition</span>(alb2_DB, </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">type =</span> <span class="st">"ONE_TO_MANY"</span>, </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">superlevelName =</span> <span class="st">"ORT2"</span>, </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sublevelName =</span> <span class="st">"Tone"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Calling <code>list_linkDefinitions()</code> again will confirm that the two levels are now linked:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list_linkDefinitions</span>(alb2_DB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["type"],"name":[1],"type":["chr"],"align":["left"]},{"label":["superlevelName"],"name":[2],"type":["chr"],"align":["left"]},{"label":["sublevelName"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"ONE_TO_MANY","2":"bundle","3":"ORT"},{"1":"ONE_TO_MANY","2":"ORT","3":"MAS"},{"1":"ONE_TO_MANY","2":"MAS","3":"MAU"},{"1":"ONE_TO_MANY","2":"ORT2","3":"Tone"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Third, <em>display the <code>Tone</code> level.</em></p>
<p>As before, this can be done with the <code>set_levelCanvasesOrder()</code> function. We now need to specify both <code>Tone</code> and <code>ORT2</code> in the <code>order</code> argument, like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set_levelCanvasesOrder</span>(alb2_DB,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">perspectiveName =</span> <span class="st">"default"</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"Tone"</span>, <span class="st">"ORT2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>serve()</code>ing the database again will now show both the <code>Tone</code> and <code>ORT2</code> levels underneath the signals:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">serve</span>(alb2_DB, <span class="at">useViewer =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calculating-and-displaying-f0" class="level3" data-number="6.3.3">
<h3 data-number="6.3.3" class="anchored" data-anchor-id="calculating-and-displaying-f0"><span class="header-section-number">6.3.3</span> Calculating and displaying <em>F</em><sub>0</sub></h3>
<p>Calculating <em>F</em><sub>0</sub> and displaying it in the <code>webApp</code> is a three-step process. Most of these steps were covered in <a href="praat2emu.html"><span>Chapter&nbsp;4</span></a>, so only a brief summary is given here.</p>
<p>First, <em>calculate F<sub>0</sub>.</em></p>
<p>We can do this using the function <code>add_ssffTrackDefinition</code> with the ‘on the fly function’ <code>mhsF0()</code> (see <a href="praat2emu.html"><span>Chapter&nbsp;4</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">add_ssffTrackDefinition</span>(alb2_DB, </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">name =</span> <span class="st">"pitch"</span>, </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">onTheFlyFunctionName =</span> <span class="st">"mhsF0"</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can confirm that this worked with the function <code>list_ssffTrackDefinitions()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list_ssffTrackDefinitions</span>(alb2_DB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["name"],"name":[1],"type":["chr"],"align":["left"]},{"label":["columnName"],"name":[2],"type":["chr"],"align":["left"]},{"label":["fileExtension"],"name":[3],"type":["chr"],"align":["left"]},{"label":["fileFormat"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"pitch","2":"pitch","3":"pit","4":"ssff"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Second, <em>configure the database to show the F<sub>0</sub> track.</em></p>
<p>As explained in <a href="praat2emu.html"><span>Chapter&nbsp;4</span></a>, the pitch data can be displayed with the function <code>set_signalCanvasesOrder()</code>. Currently, only the waveform and spectrogram are displayed, as confirmed with the <code>get_signalCanvasesOrder()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_signalCanvasesOrder</span>(alb2_DB, <span class="at">perspectiveName =</span> <span class="st">"default"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "OSCI" "SPEC"</code></pre>
</div>
</div>
<p>In order to display the pitch data underneath the spectrogram, use <code>set_signalCanvasesOrder()</code> like follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set_signalCanvasesOrder</span>(alb2_DB, </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">perspectiveName =</span> <span class="st">"default"</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"OSCI"</span>, <span class="st">"SPEC"</span>, <span class="st">"pitch"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(Alternatively, if you have installed and loaded <code>emuhelpeR</code>, you can display it like so: <code>alb2DB %&gt;% add_signal_canvas("pitch")</code>.)</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Overlaying pitch on the spectrogram
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you have the library <code>emuhelpeR</code> installed, you can overlay pitch on the spectrogram using the <code>signal_on_spec()</code> function like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emuhelpeR)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>alb2_DB <span class="sc">%&gt;%</span> <span class="fu">signal_on_spec</span>(<span class="st">"pitch"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(The function <code>clear_spec()</code> from <code>emuhelpeR</code> can be used to remove the signal from the spectrogram if you no longer wish to display it there.)</p>
<p>If you do not have <code>emuhelpeR</code> installed, the process is a bit more intricate. For this you will usually use a plain text editor to change the database’s configuration JSON file. This file always has the same name as the database + <code>config.json</code> and is stored in the same directory as the database. Once you’ve found this file, you can proceed as follows:</p>
<ul>
<li>Optionally make a backup copy of the the <code>alb2_DBconfig.json</code> file in case anything goes wrong.</li>
<li>Open <code>alb2_DBconfig.json</code> with a plain text editor, e.g.&nbsp;Notepad in Windows.</li>
<li>Search the file for the text string <code>assign</code>. You should find a line with the following contents:</li>
</ul>
<p><code>"assign": [],</code></p>
<ul>
<li>Carefully replace this line with the following:</li>
</ul>
<p><code>"assign": [{ "signalCanvasName": "SPEC", "ssffTrackName": "pitch" }],</code></p>
<ul>
<li>Save the file.</li>
<li><code>serve()</code> the database again.</li>
</ul>
<p>In principle, the configuration JSON file can also be edited in R, e.g.&nbsp;using the <code>rjson</code> library. You should probably avoid this unless you’re an advanced R user – it’s a finnicky process and a lot can go wrong.</p>
</div>
</div>
</section>
<section id="automatically-linking-annotations-at-the-tone-level" class="level3" data-number="6.3.4">
<h3 data-number="6.3.4" class="anchored" data-anchor-id="automatically-linking-annotations-at-the-tone-level"><span class="header-section-number">6.3.4</span> Automatically linking annotations at the <code>Tone</code> level</h3>
<p>The first task here is to make a few annotations. More specifically, add two pitch targets (e.g., <code>L*</code> to <em>Lena</em>, <code>L*</code> to <em>leu</em>) to the utterance <code>0001BF_1syll_1</code> as in <a href="#fig-tobi">Figure&nbsp;<span>6.1</span></a>. See <a href="wav2emu.html"><span>Chapter&nbsp;3</span></a> for details of how to annotate in the <code>Emu-webApp</code>.</p>
<p>The next task is to automatically link the annotations at the <code>Tone</code> level to the corresponding words in the <code>ORT2</code> level. We can do this using the function <code>autobuild_linkFromTimes()</code>. This function links an annotation at the <code>Tone</code> level to an annotation at the <code>ORT2</code> level if the <code>Tone</code> annotation falls within the segment segment boundaries of the <code>ORT2</code> annotation. In other words, if the start and end times of an <code>ORT2</code> annotation are denoted <em>t</em><sub>1</sub> and <em>t</em><sub>2</sub>, and the time of a <code>Tone</code> annotation is denoted simply <em>t</em>, then annotations at the two levels are linked if <em>t</em><sub>1</sub> &lt; <em>t</em> &lt; <em>t</em><sub>2</sub>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autobuild_linkFromTimes</span>(alb2_DB,</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">superlevelName =</span> <span class="st">"ORT2"</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">sublevelName =</span> <span class="st">"Tone"</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you <code>serve()</code> the database again and look at the hierarchy view, you can confirm that the links were indeed created.</p>
<p>It should now be possible to <code>query()</code> tones with respect to words and vice-versa. For example, the below query finds all words at the <code>ORT2</code> level with an annotated pitch accent at the <code>Tone</code> level. (Much more detail on querying follows in <a href="query.html"><span>Chapter&nbsp;7</span></a>!)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">query</span>(alb2_DB, <span class="st">"[Tone =~.* ^ #ORT2 =~.*]"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>db_uuid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["labels"],"name":[1],"type":["chr"],"align":["left"]},{"label":["start"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["end"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["session"],"name":[4],"type":["chr"],"align":["left"]},{"label":["bundle"],"name":[5],"type":["chr"],"align":["left"]},{"label":["start_item_id"],"name":[6],"type":["int"],"align":["right"]},{"label":["end_item_id"],"name":[7],"type":["int"],"align":["right"]},{"label":["level"],"name":[8],"type":["chr"],"align":["left"]},{"label":["attribute"],"name":[9],"type":["chr"],"align":["left"]},{"label":["start_item_seq_idx"],"name":[10],"type":["int"],"align":["right"]},{"label":["end_item_seq_idx"],"name":[11],"type":["int"],"align":["right"]},{"label":["type"],"name":[12],"type":["chr"],"align":["left"]},{"label":["sample_start"],"name":[13],"type":["int"],"align":["right"]},{"label":["sample_end"],"name":[14],"type":["int"],"align":["right"]},{"label":["sample_rate"],"name":[15],"type":["int"],"align":["right"]}],"data":[{"1":"lena","2":"1049.989","3":"1669.989","4":"0000","5":"0001BF_1syll_1","6":"26","7":"26","8":"ORT2","9":"ORT2","10":"1","11":"1","12":"SEGMENT","13":"46305","14":"73646","15":"44100"},{"1":"leu","2":"1669.989","3":"2099.989","4":"0000","5":"0001BF_1syll_1","6":"27","7":"27","8":"ORT2","9":"ORT2","10":"2","11":"2","12":"SEGMENT","13":"73647","14":"92609","15":"44100"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
</section>
<section id="adding-a-cv-level" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="adding-a-cv-level"><span class="header-section-number">6.4</span> Adding a CV level</h2>
<p>It can be helpful to have another annotation level in which every vowel corresponds to <code>V</code> and every consonant to <code>C</code>. This could then be used to establish the syllable types in the database. To do this, a new level called <code>CV</code> will be created that is an attribute of the <code>MAU</code> level (which contains the segment annotations). We do this with the <code>add_attributeDefinition()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">add_attributeDefinition</span>(alb2_DB,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levelName =</span> <span class="st">"MAU"</span>,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">name =</span> <span class="st">"CV"</span>,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">verbose=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we query all segments found at the <code>MAU</code> level in the database:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>mau.s <span class="ot">&lt;-</span> <span class="fu">query</span>(alb2_DB, <span class="st">"MAU =~ .*"</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>mau.s <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>db_uuid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["labels"],"name":[1],"type":["chr"],"align":["left"]},{"label":["start"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["end"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["session"],"name":[4],"type":["chr"],"align":["left"]},{"label":["bundle"],"name":[5],"type":["chr"],"align":["left"]},{"label":["start_item_id"],"name":[6],"type":["int"],"align":["right"]},{"label":["end_item_id"],"name":[7],"type":["int"],"align":["right"]},{"label":["level"],"name":[8],"type":["chr"],"align":["left"]},{"label":["attribute"],"name":[9],"type":["chr"],"align":["left"]},{"label":["start_item_seq_idx"],"name":[10],"type":["int"],"align":["right"]},{"label":["end_item_seq_idx"],"name":[11],"type":["int"],"align":["right"]},{"label":["type"],"name":[12],"type":["chr"],"align":["left"]},{"label":["sample_start"],"name":[13],"type":["int"],"align":["right"]},{"label":["sample_end"],"name":[14],"type":["int"],"align":["right"]},{"label":["sample_rate"],"name":[15],"type":["int"],"align":["right"]}],"data":[{"1":"<p:>","2":"0.0000","3":"1049.9887","4":"0000","5":"0001BF_1syll_1","6":"6","7":"6","8":"MAU","9":"MAU","10":"1","11":"1","12":"SEGMENT","13":"0","14":"46304","15":"44100"},{"1":"L","2":"1049.9887","3":"1359.9887","4":"0000","5":"0001BF_1syll_1","6":"7","7":"7","8":"MAU","9":"MAU","10":"2","11":"2","12":"SEGMENT","13":"46305","14":"59975","15":"44100"},{"1":"E","2":"1359.9887","3":"1449.9887","4":"0000","5":"0001BF_1syll_1","6":"8","7":"8","8":"MAU","9":"MAU","10":"3","11":"3","12":"SEGMENT","13":"59976","14":"63944","15":"44100"},{"1":"n","2":"1449.9887","3":"1479.9887","4":"0000","5":"0001BF_1syll_1","6":"9","7":"9","8":"MAU","9":"MAU","10":"4","11":"4","12":"SEGMENT","13":"63945","14":"65267","15":"44100"},{"1":"a","2":"1479.9887","3":"1669.9887","4":"0000","5":"0001BF_1syll_1","6":"10","7":"10","8":"MAU","9":"MAU","10":"5","11":"5","12":"SEGMENT","13":"65268","14":"73646","15":"44100"},{"1":"L","2":"1669.9887","3":"1879.9887","4":"0000","5":"0001BF_1syll_1","6":"11","7":"11","8":"MAU","9":"MAU","10":"6","11":"6","12":"SEGMENT","13":"73647","14":"82907","15":"44100"},{"1":"E","2":"1879.9887","3":"1949.9887","4":"0000","5":"0001BF_1syll_1","6":"12","7":"12","8":"MAU","9":"MAU","10":"7","11":"7","12":"SEGMENT","13":"82908","14":"85994","15":"44100"},{"1":"u","2":"1949.9887","3":"2099.9887","4":"0000","5":"0001BF_1syll_1","6":"13","7":"13","8":"MAU","9":"MAU","10":"8","11":"8","12":"SEGMENT","13":"85995","14":"92609","15":"44100"},{"1":"J","2":"2099.9887","3":"2259.9887","4":"0000","5":"0001BF_1syll_1","6":"14","7":"14","8":"MAU","9":"MAU","10":"9","11":"9","12":"SEGMENT","13":"92610","14":"99665","15":"44100"},{"1":"E","2":"2259.9887","3":"2289.9887","4":"0000","5":"0001BF_1syll_1","6":"15","7":"15","8":"MAU","9":"MAU","10":"10","11":"10","12":"SEGMENT","13":"99666","14":"100988","15":"44100"},{"1":"m","2":"2289.9887","3":"2459.9887","4":"0000","5":"0001BF_1syll_1","6":"16","7":"16","8":"MAU","9":"MAU","10":"11","11":"11","12":"SEGMENT","13":"100989","14":"108485","15":"44100"},{"1":"u","2":"2459.9887","3":"2729.9887","4":"0000","5":"0001BF_1syll_1","6":"17","7":"17","8":"MAU","9":"MAU","10":"12","11":"12","12":"SEGMENT","13":"108486","14":"120392","15":"44100"},{"1":"4","2":"2729.9887","3":"2769.9887","4":"0000","5":"0001BF_1syll_1","6":"18","7":"18","8":"MAU","9":"MAU","10":"13","11":"13","12":"SEGMENT","13":"120393","14":"122156","15":"44100"},{"1":"<p:>","2":"2769.9887","3":"3664.8639","4":"0000","5":"0001BF_1syll_1","6":"19","7":"19","8":"MAU","9":"MAU","10":"14","11":"14","12":"SEGMENT","13":"122157","14":"161620","15":"44100"},{"1":"<p:>","2":"0.0000","3":"1299.9887","4":"0000","5":"0001BF_2syll_1","6":"5","7":"5","8":"MAU","9":"MAU","10":"1","11":"1","12":"SEGMENT","13":"0","14":"57329","15":"44100"},{"1":"m","2":"1299.9887","3":"1469.9887","4":"0000","5":"0001BF_2syll_1","6":"6","7":"6","8":"MAU","9":"MAU","10":"2","11":"2","12":"SEGMENT","13":"57330","14":"64826","15":"44100"},{"1":"a","2":"1469.9887","3":"1629.9887","4":"0000","5":"0001BF_2syll_1","6":"7","7":"7","8":"MAU","9":"MAU","10":"3","11":"3","12":"SEGMENT","13":"64827","14":"71882","15":"44100"},{"1":"L","2":"1629.9887","3":"1879.9887","4":"0000","5":"0001BF_2syll_1","6":"8","7":"8","8":"MAU","9":"MAU","10":"4","11":"4","12":"SEGMENT","13":"71883","14":"82907","15":"44100"},{"1":"E","2":"1879.9887","3":"1969.9887","4":"0000","5":"0001BF_2syll_1","6":"9","7":"9","8":"MAU","9":"MAU","10":"5","11":"5","12":"SEGMENT","13":"82908","14":"86876","15":"44100"},{"1":"n","2":"1969.9887","3":"2009.9887","4":"0000","5":"0001BF_2syll_1","6":"10","7":"10","8":"MAU","9":"MAU","10":"6","11":"6","12":"SEGMENT","13":"86877","14":"88640","15":"44100"},{"1":"a","2":"2009.9887","3":"2189.9887","4":"0000","5":"0001BF_2syll_1","6":"11","7":"11","8":"MAU","9":"MAU","10":"7","11":"7","12":"SEGMENT","13":"88641","14":"96578","15":"44100"},{"1":"L","2":"2189.9887","3":"2429.9887","4":"0000","5":"0001BF_2syll_1","6":"12","7":"12","8":"MAU","9":"MAU","10":"8","11":"8","12":"SEGMENT","13":"96579","14":"107162","15":"44100"},{"1":"E","2":"2429.9887","3":"2509.9887","4":"0000","5":"0001BF_2syll_1","6":"13","7":"13","8":"MAU","9":"MAU","10":"9","11":"9","12":"SEGMENT","13":"107163","14":"110690","15":"44100"},{"1":"u","2":"2509.9887","3":"2669.9887","4":"0000","5":"0001BF_2syll_1","6":"14","7":"14","8":"MAU","9":"MAU","10":"10","11":"10","12":"SEGMENT","13":"110691","14":"117746","15":"44100"},{"1":"m","2":"2669.9887","3":"2849.9887","4":"0000","5":"0001BF_2syll_1","6":"15","7":"15","8":"MAU","9":"MAU","10":"11","11":"11","12":"SEGMENT","13":"117747","14":"125684","15":"44100"},{"1":"u","2":"2849.9887","3":"3059.9887","4":"0000","5":"0001BF_2syll_1","6":"16","7":"16","8":"MAU","9":"MAU","10":"12","11":"12","12":"SEGMENT","13":"125685","14":"134945","15":"44100"},{"1":"4","2":"3059.9887","3":"3099.9887","4":"0000","5":"0001BF_2syll_1","6":"17","7":"17","8":"MAU","9":"MAU","10":"13","11":"13","12":"SEGMENT","13":"134946","14":"136709","15":"44100"},{"1":"i","2":"3099.9887","3":"3269.9887","4":"0000","5":"0001BF_2syll_1","6":"18","7":"18","8":"MAU","9":"MAU","10":"14","11":"14","12":"SEGMENT","13":"136710","14":"144206","15":"44100"},{"1":"n","2":"3269.9887","3":"3419.9887","4":"0000","5":"0001BF_2syll_1","6":"19","7":"19","8":"MAU","9":"MAU","10":"15","11":"15","12":"SEGMENT","13":"144207","14":"150821","15":"44100"},{"1":"<p:>","2":"3419.9887","3":"3991.9615","4":"0000","5":"0001BF_2syll_1","6":"20","7":"20","8":"MAU","9":"MAU","10":"16","11":"16","12":"SEGMENT","13":"150822","14":"176045","15":"44100"},{"1":"<p:>","2":"0.0000","3":"1089.9887","4":"0000","5":"0001BF_3syll_1","6":"5","7":"5","8":"MAU","9":"MAU","10":"1","11":"1","12":"SEGMENT","13":"0","14":"48068","15":"44100"},{"1":"m","2":"1089.9887","3":"1309.9887","4":"0000","5":"0001BF_3syll_1","6":"6","7":"6","8":"MAU","9":"MAU","10":"2","11":"2","12":"SEGMENT","13":"48069","14":"57770","15":"44100"},{"1":"a","2":"1309.9887","3":"1429.9887","4":"0000","5":"0001BF_3syll_1","6":"7","7":"7","8":"MAU","9":"MAU","10":"3","11":"3","12":"SEGMENT","13":"57771","14":"63062","15":"44100"},{"1":"4","2":"1429.9887","3":"1469.9887","4":"0000","5":"0001BF_3syll_1","6":"8","7":"8","8":"MAU","9":"MAU","10":"4","11":"4","12":"SEGMENT","13":"63063","14":"64826","15":"44100"},{"1":"i","2":"1469.9887","3":"1869.9887","4":"0000","5":"0001BF_3syll_1","6":"9","7":"9","8":"MAU","9":"MAU","10":"5","11":"5","12":"SEGMENT","13":"64827","14":"82466","15":"44100"},{"1":"L","2":"1869.9887","3":"1909.9887","4":"0000","5":"0001BF_3syll_1","6":"10","7":"10","8":"MAU","9":"MAU","10":"6","11":"6","12":"SEGMENT","13":"82467","14":"84230","15":"44100"},{"1":"E","2":"1909.9887","3":"1939.9887","4":"0000","5":"0001BF_3syll_1","6":"11","7":"11","8":"MAU","9":"MAU","10":"7","11":"7","12":"SEGMENT","13":"84231","14":"85553","15":"44100"},{"1":"n","2":"1939.9887","3":"1969.9887","4":"0000","5":"0001BF_3syll_1","6":"12","7":"12","8":"MAU","9":"MAU","10":"8","11":"8","12":"SEGMENT","13":"85554","14":"86876","15":"44100"},{"1":"a","2":"1969.9887","3":"2109.9887","4":"0000","5":"0001BF_3syll_1","6":"13","7":"13","8":"MAU","9":"MAU","10":"9","11":"9","12":"SEGMENT","13":"86877","14":"93050","15":"44100"},{"1":"L","2":"2109.9887","3":"2259.9887","4":"0000","5":"0001BF_3syll_1","6":"14","7":"14","8":"MAU","9":"MAU","10":"10","11":"10","12":"SEGMENT","13":"93051","14":"99665","15":"44100"},{"1":"E","2":"2259.9887","3":"2349.9887","4":"0000","5":"0001BF_3syll_1","6":"15","7":"15","8":"MAU","9":"MAU","10":"11","11":"11","12":"SEGMENT","13":"99666","14":"103634","15":"44100"},{"1":"u","2":"2349.9887","3":"2499.9887","4":"0000","5":"0001BF_3syll_1","6":"16","7":"16","8":"MAU","9":"MAU","10":"12","11":"12","12":"SEGMENT","13":"103635","14":"110249","15":"44100"},{"1":"J","2":"2499.9887","3":"2659.9887","4":"0000","5":"0001BF_3syll_1","6":"17","7":"17","8":"MAU","9":"MAU","10":"13","11":"13","12":"SEGMENT","13":"110250","14":"117305","15":"44100"},{"1":"O","2":"2659.9887","3":"2859.9887","4":"0000","5":"0001BF_3syll_1","6":"18","7":"18","8":"MAU","9":"MAU","10":"14","11":"14","12":"SEGMENT","13":"117306","14":"126125","15":"44100"},{"1":"m","2":"2859.9887","3":"2909.9887","4":"0000","5":"0001BF_3syll_1","6":"19","7":"19","8":"MAU","9":"MAU","10":"15","11":"15","12":"SEGMENT","13":"126126","14":"128330","15":"44100"},{"1":"E","2":"2909.9887","3":"2939.9887","4":"0000","5":"0001BF_3syll_1","6":"20","7":"20","8":"MAU","9":"MAU","10":"16","11":"16","12":"SEGMENT","13":"128331","14":"129653","15":"44100"},{"1":"z","2":"2939.9887","3":"3089.9887","4":"0000","5":"0001BF_3syll_1","6":"21","7":"21","8":"MAU","9":"MAU","10":"17","11":"17","12":"SEGMENT","13":"129654","14":"136268","15":"44100"},{"1":"E","2":"3089.9887","3":"3229.9887","4":"0000","5":"0001BF_3syll_1","6":"22","7":"22","8":"MAU","9":"MAU","10":"18","11":"18","12":"SEGMENT","13":"136269","14":"142442","15":"44100"},{"1":"n","2":"3229.9887","3":"3419.9887","4":"0000","5":"0001BF_3syll_1","6":"23","7":"23","8":"MAU","9":"MAU","10":"19","11":"19","12":"SEGMENT","13":"142443","14":"150821","15":"44100"},{"1":"<p:>","2":"3419.9887","3":"4335.6803","4":"0000","5":"0001BF_3syll_1","6":"24","7":"24","8":"MAU","9":"MAU","10":"20","11":"20","12":"SEGMENT","13":"150822","14":"191203","15":"44100"},{"1":"<p:>","2":"0.0000","3":"899.9887","4":"0000","5":"0001CF_ord1_4","6":"9","7":"9","8":"MAU","9":"MAU","10":"1","11":"1","12":"SEGMENT","13":"0","14":"39689","15":"44100"},{"1":"L","2":"899.9887","3":"1199.9887","4":"0000","5":"0001CF_ord1_4","6":"10","7":"10","8":"MAU","9":"MAU","10":"2","11":"2","12":"SEGMENT","13":"39690","14":"52919","15":"44100"},{"1":"E","2":"1199.9887","3":"1229.9887","4":"0000","5":"0001CF_ord1_4","6":"11","7":"11","8":"MAU","9":"MAU","10":"3","11":"3","12":"SEGMENT","13":"52920","14":"54242","15":"44100"},{"1":"n","2":"1229.9887","3":"1269.9887","4":"0000","5":"0001CF_ord1_4","6":"12","7":"12","8":"MAU","9":"MAU","10":"4","11":"4","12":"SEGMENT","13":"54243","14":"56006","15":"44100"},{"1":"a","2":"1269.9887","3":"1369.9887","4":"0000","5":"0001CF_ord1_4","6":"13","7":"13","8":"MAU","9":"MAU","10":"5","11":"5","12":"SEGMENT","13":"56007","14":"60416","15":"44100"},{"1":"L","2":"1369.9887","3":"1509.9887","4":"0000","5":"0001CF_ord1_4","6":"14","7":"14","8":"MAU","9":"MAU","10":"6","11":"6","12":"SEGMENT","13":"60417","14":"66590","15":"44100"},{"1":"E","2":"1509.9887","3":"1539.9887","4":"0000","5":"0001CF_ord1_4","6":"15","7":"15","8":"MAU","9":"MAU","10":"7","11":"7","12":"SEGMENT","13":"66591","14":"67913","15":"44100"},{"1":"u","2":"1539.9887","3":"1619.9887","4":"0000","5":"0001CF_ord1_4","6":"16","7":"16","8":"MAU","9":"MAU","10":"8","11":"8","12":"SEGMENT","13":"67914","14":"71441","15":"44100"},{"1":"J","2":"1619.9887","3":"1729.9887","4":"0000","5":"0001CF_ord1_4","6":"17","7":"17","8":"MAU","9":"MAU","10":"9","11":"9","12":"SEGMENT","13":"71442","14":"76292","15":"44100"},{"1":"O","2":"1729.9887","3":"1909.9887","4":"0000","5":"0001CF_ord1_4","6":"18","7":"18","8":"MAU","9":"MAU","10":"10","11":"10","12":"SEGMENT","13":"76293","14":"84230","15":"44100"},{"1":"m","2":"1909.9887","3":"1939.9887","4":"0000","5":"0001CF_ord1_4","6":"19","7":"19","8":"MAU","9":"MAU","10":"11","11":"11","12":"SEGMENT","13":"84231","14":"85553","15":"44100"},{"1":"E","2":"1939.9887","3":"1969.9887","4":"0000","5":"0001CF_ord1_4","6":"20","7":"20","8":"MAU","9":"MAU","10":"12","11":"12","12":"SEGMENT","13":"85554","14":"86876","15":"44100"},{"1":"z","2":"1969.9887","3":"2079.9887","4":"0000","5":"0001CF_ord1_4","6":"21","7":"21","8":"MAU","9":"MAU","10":"13","11":"13","12":"SEGMENT","13":"86877","14":"91727","15":"44100"},{"1":"E","2":"2079.9887","3":"2369.9887","4":"0000","5":"0001CF_ord1_4","6":"22","7":"22","8":"MAU","9":"MAU","10":"14","11":"14","12":"SEGMENT","13":"91728","14":"104516","15":"44100"},{"1":"n","2":"2369.9887","3":"2399.9887","4":"0000","5":"0001CF_ord1_4","6":"23","7":"23","8":"MAU","9":"MAU","10":"15","11":"15","12":"SEGMENT","13":"104517","14":"105839","15":"44100"},{"1":"<p:>","2":"2399.9887","3":"2549.9887","4":"0000","5":"0001CF_ord1_4","6":"24","7":"24","8":"MAU","9":"MAU","10":"16","11":"16","12":"SEGMENT","13":"105840","14":"112454","15":"44100"},{"1":"j","2":"2549.9887","3":"2769.9887","4":"0000","5":"0001CF_ord1_4","6":"25","7":"25","8":"MAU","9":"MAU","10":"17","11":"17","12":"SEGMENT","13":"112455","14":"122156","15":"44100"},{"1":"O","2":"2769.9887","3":"2839.9887","4":"0000","5":"0001CF_ord1_4","6":"26","7":"26","8":"MAU","9":"MAU","10":"18","11":"18","12":"SEGMENT","13":"122157","14":"125243","15":"44100"},{"1":"L","2":"2839.9887","3":"3069.9887","4":"0000","5":"0001CF_ord1_4","6":"27","7":"27","8":"MAU","9":"MAU","10":"19","11":"19","12":"SEGMENT","13":"125244","14":"135386","15":"44100"},{"1":"E","2":"3069.9887","3":"3129.9887","4":"0000","5":"0001CF_ord1_4","6":"28","7":"28","8":"MAU","9":"MAU","10":"20","11":"20","12":"SEGMENT","13":"135387","14":"138032","15":"44100"},{"1":"n","2":"3129.9887","3":"3159.9887","4":"0000","5":"0001CF_ord1_4","6":"29","7":"29","8":"MAU","9":"MAU","10":"21","11":"21","12":"SEGMENT","13":"138033","14":"139355","15":"44100"},{"1":"a","2":"3159.9887","3":"3279.9887","4":"0000","5":"0001CF_ord1_4","6":"30","7":"30","8":"MAU","9":"MAU","10":"22","11":"22","12":"SEGMENT","13":"139356","14":"144647","15":"44100"},{"1":"L","2":"3279.9887","3":"3419.9887","4":"0000","5":"0001CF_ord1_4","6":"31","7":"31","8":"MAU","9":"MAU","10":"23","11":"23","12":"SEGMENT","13":"144648","14":"150821","15":"44100"},{"1":"E","2":"3419.9887","3":"3449.9887","4":"0000","5":"0001CF_ord1_4","6":"32","7":"32","8":"MAU","9":"MAU","10":"24","11":"24","12":"SEGMENT","13":"150822","14":"152144","15":"44100"},{"1":"u","2":"3449.9887","3":"3549.9887","4":"0000","5":"0001CF_ord1_4","6":"33","7":"33","8":"MAU","9":"MAU","10":"25","11":"25","12":"SEGMENT","13":"152145","14":"156554","15":"44100"},{"1":"m","2":"3549.9887","3":"3679.9887","4":"0000","5":"0001CF_ord1_4","6":"34","7":"34","8":"MAU","9":"MAU","10":"26","11":"26","12":"SEGMENT","13":"156555","14":"162287","15":"44100"},{"1":"u","2":"3679.9887","3":"3869.9887","4":"0000","5":"0001CF_ord1_4","6":"35","7":"35","8":"MAU","9":"MAU","10":"27","11":"27","12":"SEGMENT","13":"162288","14":"170666","15":"44100"},{"1":"4","2":"3869.9887","3":"3909.9887","4":"0000","5":"0001CF_ord1_4","6":"36","7":"36","8":"MAU","9":"MAU","10":"28","11":"28","12":"SEGMENT","13":"170667","14":"172430","15":"44100"},{"1":"i","2":"3909.9887","3":"4039.9887","4":"0000","5":"0001CF_ord1_4","6":"37","7":"37","8":"MAU","9":"MAU","10":"29","11":"29","12":"SEGMENT","13":"172431","14":"178163","15":"44100"},{"1":"n","2":"4039.9887","3":"4289.9887","4":"0000","5":"0001CF_ord1_4","6":"38","7":"38","8":"MAU","9":"MAU","10":"30","11":"30","12":"SEGMENT","13":"178164","14":"189188","15":"44100"},{"1":"<p:>","2":"4289.9887","3":"4898.1293","4":"0000","5":"0001CF_ord1_4","6":"39","7":"39","8":"MAU","9":"MAU","10":"31","11":"31","12":"SEGMENT","13":"189189","14":"216007","15":"44100"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>We can find unique segments (and their frequencies) using the <code>count</code> function available in the <code>tidyverse</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(mau.s, labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["labels"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"4","2":"4"},{"1":"<p:>","2":"9"},{"1":"E","2":"15"},{"1":"J","2":"3"},{"1":"L","2":"10"},{"1":"O","2":"3"},{"1":"a","2":"7"},{"1":"i","2":"3"},{"1":"j","2":"1"},{"1":"m","2":"7"},{"1":"n","2":"9"},{"1":"u","2":"8"},{"1":"z","2":"2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>We’ll store the vowels in a vector <code>vowel_phonemes</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>vowel_phonemes <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"E"</span>, <span class="st">"i"</span>, <span class="st">"O"</span>, <span class="st">"u"</span>, <span class="st">"4"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With a few <code>tidyverse</code> commands, we can wrangle <code>mau.s</code> to have the label <code>V</code> for vowels and <code>C</code> for consonants (i.e., the labels that are <em>not</em> in the <code>vowel_phonemes</code> vector), and store this as a new data frame called <code>new_items</code>.</p>
<p>We first change the values in the <code>attribute</code> column to <code>CV</code> using the <code>mutate()</code> function. We use the <code>rename()</code> function to change the <code>labels</code> column with phonemic annotations to <code>old_labels</code>. Finally we use <code>mutate()</code> in combination with <code>case_when()</code> to store the label <code>V</code> in <code>labels</code> wherever <code>old_labels</code> has a phonemic annotation found in our <code>vowel_phonemes</code> vector, and to store the label <code>C</code> in all other cases. For more resources on the <code>tidyverse</code> see the initial setup chapter.</p>
<!-- Add link to the initial setup chapter when all is done. -->
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>new_items <span class="ot">&lt;-</span> mau.s <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">attribute =</span> <span class="st">"CV"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">old_labels =</span> labels) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">labels =</span> <span class="fu">case_when</span>(old_labels <span class="sc">%in%</span> vowel_phonemes <span class="sc">~</span> <span class="st">"V"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"C"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Calling the <code>count()</code> function on <code>new_items</code> will give us the number of consonants and vowels in the database:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(new_items, labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["labels"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"C","2":"41"},{"1":"V","2":"40"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>We can add these new annotations to the attribute level <code>CV</code> using the <code>update_itemsInLevel()</code> function like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">update_itemsInLevel</span>(alb2_DB, </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">itemsToUpdate =</span> new_items,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">verbose =</span> <span class="cn">FALSE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now <code>query()</code> the <code>CV</code> level for all of its annotations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>seglist_cv <span class="ot">&lt;-</span> <span class="fu">query</span>(alb2_DB, <span class="st">"CV =~ .*"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(seglist_cv, labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["labels"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"C","2":"41"},{"1":"V","2":"40"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>More importantly, it is now possible to identify the different types of syllable structure. Recall that the <code>MAS</code> level parses the <code>Phoneme</code> level into syllables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>syll <span class="ot">&lt;-</span> <span class="fu">query</span>(alb2_DB, <span class="st">"MAS =~ .*"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(syll, labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["labels"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"4 i","2":"1"},{"1":"4 i n","2":"2"},{"1":"J E","2":"1"},{"1":"J O","2":"2"},{"1":"L E","2":"10"},{"1":"j O","2":"1"},{"1":"m E","2":"2"},{"1":"m a","2":"2"},{"1":"m u","2":"2"},{"1":"m u 4","2":"1"},{"1":"n a","2":"5"},{"1":"u","2":"5"},{"1":"z E n","2":"2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Here are the syllables in terms of their representation at the <code>CV</code> tier:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>syll.cv <span class="ot">&lt;-</span> <span class="fu">requery_hier</span>(alb2_DB, syll, <span class="at">level =</span> <span class="st">"CV"</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(syll.cv, labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["labels"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"C->V","2":"25"},{"1":"C->V->C","2":"2"},{"1":"C->V->V","2":"1"},{"1":"V","2":"5"},{"1":"V->V","2":"1"},{"1":"V->V->C","2":"2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Don’t worry if you don’t yet understand how the <code>query()</code>ing functions work – much more on that in <a href="query.html"><span>Chapter&nbsp;7</span></a>!</p>
</section>
<section id="functions-introduced-in-this-chapter" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="functions-introduced-in-this-chapter"><span class="header-section-number">6.5</span> Functions introduced in this chapter</h2>
<ul>
<li><code>signal_on_spec()</code>: Overlays a signal, such as pitch, on top of the spectrogram in the <code>Emu-webApp</code>. (Requires <code>emuhelpeR</code> to be installed).</li>
<li><code>count()</code>: Provides a count of all instances of a factor variable in a data frame or tibble.</li>
<li><code>requery_hier()</code>: Requeries an emuDB based on an existing query. Will be discussed much more in <a href="query.html"><span>Chapter&nbsp;7</span></a>.</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./forced_alignment.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Forced alignment in <code>emuR</code></span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./query.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">The Emu query language</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>