<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>An introduction to emuR - 4&nbsp; Converting a Praat TextGrid collection and tracking pitch</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./forced_alignment.html" rel="next">
<link href="./wav2emu.html" rel="prev">
<link href="./cover.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./praat2emu.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Converting a Praat TextGrid collection and tracking pitch</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">An introduction to <code>emuR</code></a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Initial setup</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">A schematic overview of the Emu Speech Database Management System</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./first_steps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">First steps in using the Emu Speech Database Management System</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wav2emu.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Creating an Emu database from .wav files</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./praat2emu.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Converting a Praat TextGrid collection and tracking pitch</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./forced_alignment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Forced alignment in <code>emuR</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tobi2emu.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Configuring <code>emuR</code> for ToBI annotations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./query.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">The Emu query language</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#objective-and-preliminaries" id="toc-objective-and-preliminaries" class="nav-link active" data-scroll-target="#objective-and-preliminaries"><span class="header-section-number">4.1</span> Objective and preliminaries</a></li>
  <li><a href="#converting-praat-textgrids" id="toc-converting-praat-textgrids" class="nav-link" data-scroll-target="#converting-praat-textgrids"><span class="header-section-number">4.2</span> Converting Praat TextGrids</a></li>
  <li><a href="#calculating-pitch-with-wrassp" id="toc-calculating-pitch-with-wrassp" class="nav-link" data-scroll-target="#calculating-pitch-with-wrassp"><span class="header-section-number">4.3</span> Calculating pitch with <code>wrassp</code></a></li>
  <li><a href="#displaying-the-pitch-files-in-the-emu-webapp" id="toc-displaying-the-pitch-files-in-the-emu-webapp" class="nav-link" data-scroll-target="#displaying-the-pitch-files-in-the-emu-webapp"><span class="header-section-number">4.4</span> Displaying the pitch files in the <code>Emu-webApp</code></a></li>
  <li><a href="#adding-an-event-level" id="toc-adding-an-event-level" class="nav-link" data-scroll-target="#adding-an-event-level"><span class="header-section-number">4.5</span> Adding an event level</a></li>
  <li><a href="#labelling-some-tones" id="toc-labelling-some-tones" class="nav-link" data-scroll-target="#labelling-some-tones"><span class="header-section-number">4.6</span> Labelling some tones</a></li>
  <li><a href="#automatically-linking-event-and-segment-times" id="toc-automatically-linking-event-and-segment-times" class="nav-link" data-scroll-target="#automatically-linking-event-and-segment-times"><span class="header-section-number">4.7</span> Automatically linking event and segment times</a></li>
  <li><a href="#functions-introduced-in-this-chapter" id="toc-functions-introduced-in-this-chapter" class="nav-link" data-scroll-target="#functions-introduced-in-this-chapter"><span class="header-section-number">4.8</span> Functions introduced in this chapter</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-praat2emu" class="quarto-section-identifier"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Converting a Praat TextGrid collection and tracking pitch</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- I wonder if the structure and placement of this chapter in the larger narrative of the book really makes sense? This isn't where people would go to figure out how to use e.g. the pitch tracking algo. If keeping this same structure, perhaps add a note at the end of preceding chapter saying that it'll continue this way? -->
<section id="objective-and-preliminaries" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="objective-and-preliminaries"><span class="header-section-number">4.1</span> Objective and preliminaries</h2>
<p>The aim of this chapter is to show how to get from a Praat <code>.TextGrid</code> format to an Emu database format. We will show how to convert pairs of <code>.wav</code> and <code>.TextGrid</code> files to an Emu database, how to generate pitch tracks over the sound files, how to add annotation levels in the style of Praat’s point tiers, and finally how to convert the flat annotation structure of Praat TextGrids into the layered annotation structure of an Emu database (see <a href="intro.html"><span>Chapter&nbsp;1</span></a>).</p>
<p><a href="#fig-praat2emu">Figure&nbsp;<span>4.1</span></a> exemplifies an annotated sound file in Praat with pitch overlaid on the spectrogram. Below this, we see the <code>Emu-webApp</code> we want to achieve, with a visible pitch track, annotations, and a layered annotation structure.</p>
<div id="fig-praat2emu" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/figpraat.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;4.1: An utterance fragment in Praat and in Emu.</figcaption>
</figure>
</div>
<p>The assumption is that you already have an R project called <code>ipsR</code> and that it contains the directories <code>emu_databases</code> and <code>testsample</code>. If this is not the case, please go back and follow the preliminaries chapter.</p>
<!-- add final link to prelim chapter when this is done -->
<p>Start up R in the project you are using for this course and load the usual libraries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emuR)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wrassp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In R, store the path to the directory <code>testsample</code> as <code>sourceDir</code> in the following way:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>sourceDir <span class="ot">&lt;-</span> <span class="st">"./testsample"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And also store in R the path to <code>emu_databases</code> as <code>targetDir</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>targetDir <span class="ot">&lt;-</span> <span class="st">"./emu_databases"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="converting-praat-textgrids" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="converting-praat-textgrids"><span class="header-section-number">4.2</span> Converting Praat TextGrids</h2>
<p>The directory <code>testsample/praat</code> on your computer contains a Praat-style database with <code>.wav</code> files and <code>.TextGrid</code> files. Define the path to this database in R and check that you can see these files with the <code>list.files()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>path.praat <span class="ot">&lt;-</span> <span class="fu">file.path</span>(sourceDir, <span class="st">"praat"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>(path.praat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "wetter1.TextGrid"  "wetter1.wav"       "wetter10.TextGrid"
 [4] "wetter10.wav"      "wetter11.TextGrid" "wetter11.wav"     
 [7] "wetter12.TextGrid" "wetter12.wav"      "wetter13.TextGrid"
[10] "wetter13.wav"      "wetter14.TextGrid" "wetter14.wav"     
[13] "wetter15.TextGrid" "wetter15.wav"      "wetter16.TextGrid"
[16] "wetter16.wav"      "wetter17.TextGrid" "wetter17.wav"     
[19] "wetter2.TextGrid"  "wetter2.wav"       "wetter3.TextGrid" 
[22] "wetter3.wav"       "wetter4.TextGrid"  "wetter4.wav"      
[25] "wetter6.TextGrid"  "wetter6.wav"       "wetter7.TextGrid" 
[28] "wetter7.wav"      </code></pre>
</div>
</div>
<p>The <code>emuR</code> function for converting the collection of <code>.wav</code> / <code>.TextGrid</code> pairs to an Emu database called and then storing the latter in <code>targetDir</code> (defined above) is <code>convert_TextGridCollection()</code>. It works like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">convert_TextGridCollection</span>(path.praat, </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">dbName =</span> <span class="st">"praat"</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">targetDir =</span> targetDir,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The converted Praat database called <code>praat_emuDB</code> can now be loaded with <code>load_emuDB()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>praat_DB <span class="ot">&lt;-</span> <span class="fu">load_emuDB</span>(<span class="fu">file.path</span>(targetDir, <span class="st">"praat_emuDB"</span>),</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And its properties can be examined with the <code>summary()</code> command as we’ve seen in previous chapters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(praat_DB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Summary of emuDB ────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Name:    praat 
UUID:    4c19bd0b-06eb-4500-b7ad-833ffceba0c9 
Directory:   C:\Users\rasmu\surfdrive\emuintro\emuintro\emu_databases\praat_emuDB 
Session count: 1 
Bundle count: 14 
Annotation item count:  214 
Label count:  214 
Link count:  0 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Database configuration ──────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── SSFF track definitions ──</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>dataramme med 0 kolonner og 0 rækker</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Level definitions ──</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> name type    nrOfAttrDefs attrDefNames
 ORT  SEGMENT 1            ORT;        </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Link definitions ──</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>dataramme med 0 kolonner og 0 rækker</code></pre>
</div>
</div>
<p>You’ll see that there are no <code>Link definitions</code>, as <code>.TextGrid</code>s do not offer this kind of structure.</p>
<p>The database can of course be viewed using the <code>serve()</code> command as we’ve seen in previous chapters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">serve</span>(praat_DB, <span class="at">useViewer =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calculating-pitch-with-wrassp" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="calculating-pitch-with-wrassp"><span class="header-section-number">4.3</span> Calculating pitch with <code>wrassp</code></h2>
<!-- The original doc used what seemed like a very roundabout way to calculate pitch, by first generating files with wrassp::mhsF0 based on the original wav collection and then adding them in a multistep procedure. I'll go ahead and do everything with onTheFlyFunctionName. -->
<p>The <code>summary()</code> above showed that there are no SSFF tracks associated with the database – this is also not a file structure that Praat understands. Recall from <a href="first_steps.html"><span>Chapter&nbsp;2</span></a> that SSFF tracks store signal data that is timelocked to the audio signal. In this next step, we will generate SSFF tracks for <code>praat_emuDB</code> containing information about pitch.</p>
<p>In order to do this, we use the signal processing package <code>wrassp</code>. There are several different signal processing packages in R, and several of them have pitch tracking algorithms. We work with <code>wrassp</code> here because it was developed in conjunction with <code>emuR</code>, and thus is very easy to integrate with <code>emuR</code>.</p>
<p>To see the full range of signal processing routines available in <code>wrassp</code>, enter <code>?wrassp</code> in the R console. There are two functions for calculating pitch: <code>ksvF0()</code> and <code>mhsF0()</code>. For this demonstration, we will use <code>mhsF0()</code>.</p>
<p>The function <code>mhsF0()</code> (and other signal processing functions in <code>wrassp</code>) operates directly on one or more <code>.wav</code> files, and creates corresponding new files containing pitch tracks. It does not care whether those <code>.wav</code> files are part of an Emu database, so to speak. In order to add SSFF tracks that are based on the signal processing capabilities in <code>wrassp</code> directly to an Emu database, we can use the handy <code>emuR</code> function <code>add_ssffTrackDefinition()</code> with the argument <code>onTheFlyFunctionName</code>. The <code>onTheFlyFunctionName</code> should usually be one of the signal processing routines in <code>wrassp</code>, although other functions can also be used.</p>
<p>Here’s how to use <code>mhsF0()</code> to generate pitch tracks with the default settings and add them to a Emu database:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">add_ssffTrackDefinition</span>(praat_DB, <span class="at">name=</span><span class="st">'pitch'</span>, <span class="at">onTheFlyFunctionName=</span><span class="st">'mhsF0'</span>,</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we run <code>list_ssffTrackDefinitions()</code> we will now see that an SSFF track called <code>pitch</code> with the file extension <code>.pit</code> has been added:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list_ssffTrackDefinitions</span>(praat_DB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["name"],"name":[1],"type":["chr"],"align":["left"]},{"label":["columnName"],"name":[2],"type":["chr"],"align":["left"]},{"label":["fileExtension"],"name":[3],"type":["chr"],"align":["left"]},{"label":["fileFormat"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"pitch","2":"pitch","3":"pit","4":"ssff"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Changing the pitch tracking parameters
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is often not a good idea to use the default parameters for pitch tracking. For example, <code>mhsF0()</code> and <code>ksvF0()</code> by default search for pitch in an extremely broad frequency range (between 50–600 Hz), and narrowing this down often gives better results. We can see all possible <code>mhsF0()</code> parameters using the <code>args()</code> function, which returns all arguments of a given function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">args</span>(mhsF0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (listOfFiles = NULL, optLogFilePath = NULL, beginTime = 0, 
    centerTime = FALSE, endTime = 0, windowShift = 5, gender = "u", 
    maxF = 600, minF = 50, minAmp = 50, minAC1 = 0.25, minRMS = 18, 
    maxZCR = 3000, minProb = 0.52, plainSpectrum = FALSE, toFile = TRUE, 
    explicitExt = NULL, outputDirectory = NULL, forceToLog = useWrasspLogger, 
    verbose = TRUE) 
NULL</code></pre>
</div>
</div>
<p>All of these arguments can be changed. If you want to change the settings when adding an SSFF track, you can pass a <em>named list</em> of parameters to the argument <code>onTheFlyParams</code> in the <code>add_ssffTrackDefinition()</code> call. A named list looks e.g.&nbsp;like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>pitch_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">maxF =</span> <span class="dv">400</span>, <span class="at">minF =</span> <span class="dv">75</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The function call to add pitch tracks with these parameters looks like this. Since we already have a track called <code>pitch</code> with the file extension <code>pit</code>, we call this one <code>pitch2</code> and use the file extension <code>pit2</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">add_ssffTrackDefinition</span>(praat_DB, <span class="at">name=</span><span class="st">'pitch2'</span>, </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">onTheFlyFunctionName=</span><span class="st">'mhsF0'</span>,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">onTheFlyParams=</span>pitch_params,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fileExtension=</span><span class="st">'pit2'</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">verbose=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- would be good to have an explainer about how to add non-wrassp files -->
</div>
</div>
</section>
<section id="displaying-the-pitch-files-in-the-emu-webapp" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="displaying-the-pitch-files-in-the-emu-webapp"><span class="header-section-number">4.4</span> Displaying the pitch files in the <code>Emu-webApp</code></h2>
<p>As seen in <a href="first_steps.html"><span>Chapter&nbsp;2</span></a>, we can use the function <code>get_signalCanvasesOrder()</code> to see which signals are currently displayed in the database:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_signalCanvasesOrder</span>(praat_DB, <span class="at">perspectiveName =</span> <span class="st">"default"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "OSCI" "SPEC"</code></pre>
</div>
</div>
<p>This confirms that what is seen when viewing the database with the <code>serve()</code> function is the waveform (<code>OSCI</code>) and the spectrogram (<code>SPEC</code>). The pitch data created above now needs to be added using the function <code>set_signalCanvasesOrder()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set_signalCanvasesOrder</span>(praat_DB, </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">perspectiveName =</span> <span class="st">"default"</span>,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"OSCI"</span>, <span class="st">"SPEC"</span>, <span class="st">"pitch"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(Alternatively, if you have installed <code>emuhelpeR</code>, you can add it like so: <code>praat_DB %&gt;% add_signal_canvas('pitch')</code>).</p>
<p>The pitch track should now be visible when you <code>serve()</code> the database:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">serve</span>(praat_DB, <span class="at">useViewer =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="adding-an-event-level" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="adding-an-event-level"><span class="header-section-number">4.5</span> Adding an event level</h2>
<p>The next task is to add an annotation level of type <code>EVENT</code> (similar to “point tiers” in Praat) that can be used for labeling tones. We will call this level <code>Tone</code>. So far, the only existing annotation level with time information is <code>ORT</code> as confirmed with:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list_levelDefinitions</span>(praat_DB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["name"],"name":[1],"type":["chr"],"align":["left"]},{"label":["type"],"name":[2],"type":["chr"],"align":["left"]},{"label":["nrOfAttrDefs"],"name":[3],"type":["int"],"align":["right"]},{"label":["attrDefNames"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"ORT","2":"SEGMENT","3":"1","4":"ORT;"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>In order to add a new <code>EVENT</code>-type level called <code>Tone</code>, we use the function <code>add_levelDefinition()</code> like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">add_levelDefinition</span>(praat_DB, </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">"Tone"</span>, </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">type =</span> <span class="st">"EVENT"</span>,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>set_levelCanvasesOrder()</code> can be used to ensure that <code>Tone</code> is shown when directly underneath the signals when <code>serve()</code>ing the database:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set_levelCanvasesOrder</span>(praat_DB, </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">perspectiveName =</span> <span class="st">"default"</span>, </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"Tone"</span>, <span class="st">"ORT"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="labelling-some-tones" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="labelling-some-tones"><span class="header-section-number">4.6</span> Labelling some tones</h2>
<p>Try and add two tone labels <code>H*</code> at the time of the pitch peaks of <code>morgens</code> and <code>ruhig</code> in the bundle <code>wetter1</code> as in <a href="#fig-praat2emu">Figure&nbsp;<span>4.1</span></a> and save the result. The pointers for annotating given in <a href="first_steps.html"><span>Chapter&nbsp;2</span></a> also apply here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">serve</span>(praat_DB, <span class="at">useViewer =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>At present, there are no defined relationships between the different annotation levels, as confirmed with <code>list_linkDefinitions()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list_linkDefinitions</span>(praat_DB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
<p>We would like the tones we annotate to be linked to words within which they occur in time. To do this, we use <code>add_linkDefinition()</code> to define a hierarchical relationship such that <code>ORT</code> dominates <code>Tone</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">add_linkDefinition</span>(praat_DB, </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">type =</span> <span class="st">"ONE_TO_MANY"</span>, </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">superlevelName =</span> <span class="st">"ORT"</span>, </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sublevelName =</span> <span class="st">"Tone"</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="fu">list_linkDefinitions</span>(praat_DB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["type"],"name":[1],"type":["chr"],"align":["left"]},{"label":["superlevelName"],"name":[2],"type":["chr"],"align":["left"]},{"label":["sublevelName"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"ONE_TO_MANY","2":"ORT","3":"Tone"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>To see the results of this procedure, <code>serve()</code> the database again and switch to hierarchy view.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">serve</span>(praat_DB, <span class="at">useViewer =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="automatically-linking-event-and-segment-times" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="automatically-linking-event-and-segment-times"><span class="header-section-number">4.7</span> Automatically linking event and segment times</h2>
<p>Once a hierarchical relationship has been established, between two levels, times can be linked using the <code>autobuild_linkFromTimes()</code> function, like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autobuild_linkFromTimes</span>(praat_DB,</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">superlevelName =</span> <span class="st">"ORT"</span>,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">sublevelName =</span> <span class="st">"Tone"</span>,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To see the results of this procedure, <code>serve()</code> the database again and switch to hierarchy view.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">serve</span>(praat_DB, <span class="at">useViewer =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this chapter, we have seen how to convert a collection of Praat-based annotations and sound files into an Emu database, and we’ve taken the first steps towards analyzing and annotating pitch. In <a href="tobi2emu.html"><span>Chapter&nbsp;6</span></a>, we’ll go into more detail about the analysis and annotation of intonation.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Want to make plots in the style of Praat Picture?
</div>
</div>
<div class="callout-body-container callout-body">
<p>A very nice feature of Praat is that when you’ve found a nice portion of the signal, it’s fairly simple to make a plot that combines waveform, spectrogram, other derived tracks, and annotations. Say you’ve fallen in love with the portion in <code>wetter3</code> in our <code>praat_emuDB</code>, and you want to plot the <em>zu Samstag</em> portion. Unfortunately, there are no functions internal to <code>emuR</code> that allows you to plot audio data along with annotations, but the package <code>praatpicture</code> allows this.</p>
<p><code>praatpicture</code> can be installed in the usual way:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"praatpicture"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The function <code>emupicture()</code> can now be called to produce a Praat-style plot like so, setting the <code>start</code> and <code>end</code> time to plot our favorite part of the signal. The argument <code>tg_tiers</code> specifies which annotation levels (equivalent to <em>TextGrid tiers</em> should be plotted), and the <code>wave_channels</code> argument specifies which channels of the sound file should be plotted. (This is not visible in the <code>Emu-webApp</code>, but the sound files in <code>praat_DB</code> actually have two channels).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(praatpicture)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">emupicture</span>(praat_DB, <span class="at">bundle=</span><span class="st">'wetter3'</span>, <span class="at">start=</span><span class="fl">0.6</span>, <span class="at">end=</span><span class="fl">1.275</span>, <span class="at">tg_tiers=</span><span class="st">'ORT'</span>,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">wave_channels=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="praat2emu_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For my information about the options you get with <code>emupicture()</code> and the <code>praatpicture</code> library, see <a href="https://rpuggaardrode.github.io/praatpicture_manual" target="_blank">the manual</a>.</p>
</div>
</div>
</section>
<section id="functions-introduced-in-this-chapter" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="functions-introduced-in-this-chapter"><span class="header-section-number">4.8</span> Functions introduced in this chapter</h2>
<!-- add something about how sessions are generated from directory structure -->
<ul>
<li><code>convert_TextGridCollection()</code>: converts pairs of <code>.wav</code> and <code>.TextGrid</code> files to an Emu database.</li>
<li><code>mhsF0()</code> and <code>ksvF0()</code>: generates files with pitch track information from one or more sound files.</li>
<li><code>add_ssffTrackDefinition()</code>: adds SSFF files with track information timelocked with the audio signal; often done on the fly with signal processing functions from <code>wrassp</code></li>
<li><code>add_linkDefinition()</code>: establishes a hierarchical relationship between two annotation levels</li>
<li><code>autobuild_linkFromTimes()</code>: uses time information to link annotation items on two tiers automatically</li>
<li><code>emupicture()</code>: makes plots combining signal and annotation in the style of Praat Picture (requires <code>praatpicture</code> to be installed)</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./wav2emu.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Creating an Emu database from .wav files</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./forced_alignment.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Forced alignment in <code>emuR</code></span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>